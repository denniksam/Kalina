function Kalina(b,k){
    var I=this,i,j;
    if(b==128){I.c = 2; I.c_1 = 1;}else if(b==256){I.c = 4; I.c_1 = 3;}else if(b==512){I.c = 8; I.c_1 = 7;}else throw "Invalid block size"; 
    if(k==128)I.r = 10;else if(k==256)I.r = 14;else if(k==512)I.r = 18;else throw "Invalid key size";
    I.b=b;I.k=k;
    I.P = [1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,1];
    I.R = [0,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175];
	I.S=[];
    I.S[0]=I.S[4]=[168,67,95,6,107,117,108,89,113,223,135,149,23,240,216,9,109,243,29,203,201,77,44,175,121,224,151,253,111,75,69,57,62,221,163,79,180,182,154,14,31,191,21,225,73,210,147,198,146,114,158,97,209,99,250,238,244,25,213,173,88,164,187,161,220,242,131,55,66,228,122,50,156,204,171,74,143,110,4,39,46,231,226,90,150,22,35,43,194,101,102,15,188,169,71,65,52,72,252,183,106,136,165,83,134,249,91,219,56,123,195,30,34,51,36,40,54,199,178,59,142,119,186,245,20,159,8,85,155,76,254,96,92,218,24,70,205,125,33,176,63,27,137,255,235,132,105,58,157,215,211,112,103,64,181,222,93,48,145,177,120,17,1,229,0,104,152,160,197,2,166,116,45,11,162,118,179,190,206,189,174,233,138,49,28,236,241,153,148,170,246,38,47,239,232,140,53,3,212,127,251,5,193,94,144,32,61,130,247,234,10,13,126,248,80,26,196,7,87,184,60,98,227,200,172,82,100,16,208,217,19,12,18,41,81,185,207,214,115,141,129,84,192,237,78,68,167,42,133,37,230,202,124,139,86,128];
    I.S[1]=I.S[5]=[206,187,235,146,234,203,19,193,233,58,214,178,210,144,23,248,66,21,86,180,101,28,136,67,197,92,54,186,245,87,103,141,49,246,100,88,158,244,34,170,117,15,2,177,223,109,115,77,124,38,46,247,8,93,68,62,159,20,200,174,84,16,216,188,26,107,105,243,189,51,171,250,209,155,104,78,22,149,145,238,76,99,142,91,204,60,25,161,129,73,123,217,111,55,96,202,231,43,72,253,150,69,252,65,18,13,121,229,137,140,227,32,48,220,183,108,74,181,63,151,212,98,45,6,164,165,131,95,42,218,201,0,126,162,85,191,17,213,156,207,14,10,61,81,125,147,27,254,196,71,9,134,11,143,157,106,7,185,176,152,24,50,113,75,239,59,112,160,228,64,255,195,169,230,120,249,139,70,128,30,56,225,184,168,224,12,35,118,29,37,36,5,241,110,148,40,154,132,232,163,79,119,211,133,226,82,242,130,80,122,47,116,83,179,97,175,57,53,222,205,31,153,172,173,114,44,221,208,135,190,94,166,236,4,198,3,52,251,219,89,182,194,1,240,90,237,167,102,33,127,138,39,199,192,41,215];
    I.S[2]=I.S[6]=[147,217,154,181,152,34,69,252,186,106,223,2,159,220,81,89,74,23,43,194,148,244,187,163,98,228,113,212,205,112,22,225,73,60,192,216,92,155,173,133,83,161,122,200,45,224,209,114,166,44,196,227,118,120,183,180,9,59,14,65,76,222,178,144,37,165,215,3,17,0,195,46,146,239,78,18,157,125,203,53,16,213,79,158,77,169,85,198,208,123,24,151,211,54,230,72,86,129,143,119,204,156,185,226,172,184,47,21,164,124,218,56,30,11,5,214,20,110,108,126,102,253,177,229,96,175,94,51,135,201,240,93,109,63,136,141,199,247,29,233,236,237,128,41,39,207,153,168,80,15,55,36,40,48,149,210,62,91,64,131,179,105,87,31,7,28,138,188,32,235,206,142,171,238,49,162,115,249,202,58,26,251,13,193,254,250,242,111,189,150,221,67,82,182,8,243,174,190,25,137,50,38,176,234,75,100,132,130,107,245,121,191,1,95,117,99,27,35,61,104,42,101,232,145,246,255,19,88,241,71,10,127,197,167,231,97,90,6,70,68,66,4,160,219,57,134,84,170,140,52,33,139,248,12,116,103];
    I.S[3]=I.S[7]=[104,141,202,77,115,75,78,42,212,82,38,179,84,30,25,31,34,3,70,61,45,74,83,131,19,138,183,213,37,121,245,189,88,47,13,2,237,81,158,17,242,62,85,94,209,22,60,102,112,93,243,69,64,204,232,148,86,8,206,26,58,210,225,223,181,56,110,14,229,244,249,134,233,79,214,133,35,207,50,153,49,20,174,238,200,72,211,48,161,146,65,177,24,196,44,113,114,68,21,253,55,190,95,170,155,136,216,171,137,156,250,96,234,188,98,12,36,166,168,236,103,32,219,124,40,221,172,91,52,126,16,241,123,143,99,160,5,154,67,119,33,191,39,9,195,159,182,215,41,194,235,192,164,139,140,29,251,255,193,178,151,46,248,101,246,117,7,4,73,51,228,217,185,208,66,199,108,144,0,142,111,80,1,197,218,71,63,205,105,162,226,122,167,198,147,15,10,6,230,43,150,163,28,175,106,18,132,57,231,176,130,247,254,157,135,92,129,53,222,180,165,252,128,239,203,187,107,118,186,90,125,120,11,149,227,173,116,152,59,54,100,109,220,240,89,169,76,23,127,145,184,201,87,27,224,97];
    I.Q=[];
    I.Q[0]=I.Q[4]=[164,162,169,197,78,201,3,217,126,15,210,173,231,211,39,91,227,161,232,230,124,42,85,12,134,57,215,141,184,18,111,40,205,138,112,86,114,249,191,79,115,233,247,87,22,172,80,192,157,183,71,113,96,196,116,67,108,31,147,119,220,206,32,140,153,95,68,1,245,30,135,94,97,44,75,29,129,21,244,35,214,234,225,103,241,127,254,218,60,7,83,106,132,156,203,2,131,51,221,53,226,89,90,152,165,146,100,4,6,16,77,28,151,8,49,238,171,5,175,121,160,24,70,109,252,137,212,199,255,240,207,66,145,248,104,10,101,142,182,253,195,239,120,76,204,158,48,46,188,11,84,26,166,187,38,128,72,148,50,125,167,63,174,34,61,102,170,246,0,93,189,74,224,59,180,23,139,159,118,176,36,154,37,99,219,235,122,62,92,179,177,41,242,202,88,110,216,168,47,117,223,20,251,19,73,136,178,236,228,52,45,150,198,58,237,149,14,229,133,107,64,33,155,9,25,43,82,222,69,163,250,81,194,181,209,144,185,243,55,193,13,186,65,17,56,123,190,208,213,105,54,200,98,27,130,143];
    I.Q[1]=I.Q[5]=[131,242,42,235,233,191,123,156,52,150,141,152,185,105,140,41,61,136,104,6,57,17,76,14,160,86,64,146,21,188,179,220,111,248,38,186,190,189,49,251,195,254,128,97,225,122,50,210,112,32,161,69,236,217,26,93,180,216,9,165,85,142,55,118,169,103,16,23,54,101,177,149,98,89,116,163,80,47,75,200,208,143,205,212,60,134,18,29,35,239,244,83,25,53,230,127,94,214,121,81,34,20,247,30,74,66,155,65,115,45,193,92,166,162,224,46,211,40,187,201,174,106,209,90,48,144,132,249,178,88,207,126,197,203,151,228,22,108,250,176,109,31,82,153,13,78,3,145,194,77,100,119,159,221,196,73,138,154,36,56,167,87,133,199,124,125,231,246,183,172,39,70,222,223,59,215,158,43,11,213,19,117,240,114,182,157,27,1,63,68,229,135,253,7,241,171,148,24,234,252,58,130,95,5,84,219,0,139,227,72,12,202,120,137,10,255,62,91,129,238,113,226,218,44,184,181,204,110,168,107,173,96,198,8,4,2,232,245,79,164,243,192,206,67,37,28,33,51,15,175,71,237,102,99,147,170];
    I.Q[2]=I.Q[6]=[69,212,11,67,241,114,237,164,194,56,230,113,253,182,58,149,80,68,75,226,116,107,30,17,90,198,180,216,165,138,112,163,168,250,5,217,151,64,201,144,152,143,220,18,49,44,71,106,153,174,200,127,249,79,93,150,111,244,179,57,33,218,156,133,158,59,240,191,239,6,238,229,95,32,16,204,60,84,74,82,148,14,192,40,246,86,96,162,227,15,236,157,36,131,126,213,124,235,24,215,205,221,120,255,219,161,9,208,118,132,117,187,29,26,47,176,254,214,52,99,53,210,42,89,109,77,119,231,142,97,207,159,206,39,245,128,134,199,166,251,248,135,171,98,63,223,72,0,20,154,189,91,4,146,2,37,101,76,83,12,242,41,175,23,108,65,48,233,147,85,247,172,104,38,196,125,202,122,62,160,55,3,193,54,105,102,8,22,167,188,197,211,34,183,19,70,50,232,87,136,43,129,178,78,100,28,170,145,88,46,155,92,27,81,115,66,35,1,110,243,13,190,61,10,45,31,103,51,25,123,94,234,222,139,203,169,140,141,173,73,130,228,186,195,21,209,224,137,252,177,185,181,7,121,184,225];
    I.Q[3]=I.Q[7]=[178,182,35,17,167,136,197,166,57,143,196,232,115,34,67,195,130,39,205,24,81,98,45,247,92,14,59,253,202,155,13,15,121,140,16,76,116,28,10,142,124,148,7,199,94,20,161,33,87,80,78,169,128,217,239,100,65,207,60,238,46,19,41,186,52,90,174,138,97,51,18,185,85,168,21,5,246,3,6,73,181,37,9,22,12,42,56,252,32,244,229,127,215,49,43,102,111,255,114,134,240,163,47,120,0,188,204,226,176,241,66,180,48,95,96,4,236,165,227,139,231,29,191,132,123,230,129,248,222,216,210,23,206,75,71,214,105,108,25,153,154,1,179,133,177,249,89,194,55,233,200,160,237,79,137,104,109,213,38,145,135,88,189,201,152,220,117,192,118,245,103,107,126,235,82,203,209,91,159,11,219,64,146,26,250,172,228,225,113,31,101,141,151,158,149,144,93,183,193,175,84,251,2,224,53,187,58,77,173,44,61,86,8,27,74,147,106,171,184,122,242,125,218,63,254,62,190,234,170,68,198,208,54,72,112,150,119,36,83,223,243,131,40,50,69,30,164,211,162,70,110,156,221,99,212,157];
    I.v=[1,1,5,1,8,6,7,4];
    I._v=[173,149,118,168,47,73,215,202]; 
	I.shift=[];for(i=0;i<8;i++)I.shift[i]=parseInt(i*b/512);
	I.G=[];for(j=0;j<I.c;j++)I.G[j]=[0,0,0,0,0,0,0,0];	
    I.M=function(x,y){if(x==0||y==0)return 0;return I.P[I.R[x]+I.R[y]];}
    I.l = (I.k == 2*I.b)?2*I.c:I.c;
    I.K = [];for(j=0;j<I.l;j++)I.K[j] = [0,0,0,0,0,0,0,0];
    I.Kr=[];for(i=0;i<=I.r;i++){I.Kr[i]=[];for(j=0;j<I.c;j++)I.Kr[i][j]=[0,0,0,0,0,0,0,0];}
    I.T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";//RFC 3548 sec 4
    
    I.setKeyHex=function(h){for(j=0;j<I.l;j++)for(i=0;i<8;i++){if(h[(j*8+i)*2]!==undefined&&h[(j*8+i)*2+1]!==undefined)I.K[j][i]=parseInt(h[(j*8+i)*2]+''+h[(j*8+i)*2+1],16);else throw "Invalid key hexadecimal format";}I.expandKey();}
    I.toString=function(k=I.G){t="";for(j=0;j<I.c;j++)for(i=0;i<8;i++){if(k[j][i]<16)t+='0';t+=k[j][i].toString(16);}return t;}
    I.keyToString=function(k=I.K){t="";for(j=0;j<I.l;j++)for(i=0;i<8;i++){if(k[j][i]<16)t+='0';t+=k[j][i].toString(16);}return t;}
    I.expandKey=function(){
		var i,j,c,a,n,w,A=[],B=[],C=[],D,Ks=[],q=[[],[],[],[],[],[],[],[],[],[]],x=(I.b/4+24)/8,o=(I.k==2*I.b)?I.c:0;
		for(j=0;j<I.l;j++){A[j]=[0,0,0,0,0,0,0,0];B[j]=[0,0,0,0,0,0,0,0];C[j]=[0,0,0,0,0,0,0,0];Ks[j]=[0,0,0,0,0,0,0,0];}
		A[0][0]=(I.k+I.b+64)/64;
		for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){A[j][i]=A[j][i]+I.K[j][i]+c;if(A[j][i]>255){A[j][i]&=255;c=1;}else c=0;A[j][i]=I.S[i][A[j][i]];B[(j+I.shift[i])&(I.c_1)][i]=A[j][i];}}
        for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],B[j][k]);A[j][i]=I.S[i][(a&255)^I.K[j+o][i]];C[(j+I.shift[i])&(I.c_1)][i]=A[j][i];}
		for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],C[j][k]);A[j][i]=(a&255)+I.K[j][i]+c;if(A[j][i]>255){A[j][i]&=255;c=1;}else c=0;A[j][i]=I.S[i][A[j][i]];B[(j+I.shift[i])&(I.c_1)][i]=A[j][i];}}
        for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],B[j][k]);Ks[j][i]=(a&255);}
		for(j=0;j<I.c;j++){q[0][j] = [1,0,1,0,1,0,1,0];q[1][j] = [2,0,2,0,2,0,2,0];q[2][j] = [4,0,4,0,4,0,4,0];q[3][j] = [8,0,8,0,8,0,8,0];q[4][j] = [16,0,16,0,16,0,16,0];q[5][j] = [32,0,32,0,32,0,32,0];q[6][j] = [64,0,64,0,64,0,64,0];q[7][j] = [128,0,128,0,128,0,128,0];q[8][j] = [0,1,0,1,0,1,0,1];q[9][j] = [0,2,0,2,0,2,0,2];}

		if(I.b==128&&I.k==128){w={0:I.K,2:{0:I.K[1],1:I.K[0]}};for(i=4;i<=I.r;i+=2)w[i]=w[i-4];}
        if(I.b==128&&I.k==256){w={0:I.K,2:{0:I.K[2],1:I.K[3],2:I.K[0],3:I.K[1]},4:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[0]},6:{0:I.K[3],1:I.K[0],2:I.K[1],3:I.K[2]},8:{0:I.K[2],1:I.K[3],2:I.K[0],3:I.K[1]},10:I.K,12:{0:I.K[3],1:I.K[0],2:I.K[1],3:I.K[2]},14:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[0]}};}
		if(I.b==256&&I.k==256){w={0:I.K,2:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[0]},4:{0:I.K[2],1:I.K[3],2:I.K[0],3:I.K[1]},6:{0:I.K[3],1:I.K[0],2:I.K[1],3:I.K[2]},8:I.K,10:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[0]},12:{0:I.K[2],1:I.K[3],2:I.K[0],3:I.K[1]},14:{0:I.K[3],1:I.K[0],2:I.K[1],3:I.K[2]}};}
        if(I.b==256&&I.k==512){w={0:I.K,2:{0:I.K[4],1:I.K[5],2:I.K[6],3:I.K[7],4:I.K[0],5:I.K[1],6:I.K[2],7:I.K[3]},4:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[4],4:I.K[5],5:I.K[6],6:I.K[7],7:I.K[0]},6:{0:I.K[5],1:I.K[6],2:I.K[7],3:I.K[0],4:I.K[1],5:I.K[2],6:I.K[3],7:I.K[4]},8:{0:I.K[2],1:I.K[3],2:I.K[4],3:I.K[5],4:I.K[6],5:I.K[7],6:I.K[0],7:I.K[1]},10:{0:I.K[6],1:I.K[7],2:I.K[0],3:I.K[1],4:I.K[2],5:I.K[3],6:I.K[4],7:I.K[5]},12:{0:I.K[3],1:I.K[4],2:I.K[5],3:I.K[6],4:I.K[7],5:I.K[0],6:I.K[1],7:I.K[2]},14:{0:I.K[7],1:I.K[0],2:I.K[1],3:I.K[2],4:I.K[3],5:I.K[4],6:I.K[5],7:I.K[6]},16:{0:I.K[4],1:I.K[5],2:I.K[6],3:I.K[7],4:I.K[0],5:I.K[1],6:I.K[2],7:I.K[3]},18:I.K};}
		if(I.b==512&&I.k==512){w={0:I.K,2:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[4],4:I.K[5],5:I.K[6],6:I.K[7],7:I.K[0]},4:{0:I.K[2],1:I.K[3],2:I.K[4],3:I.K[5],4:I.K[6],5:I.K[7],6:I.K[0],7:I.K[1]},6:{0:I.K[3],1:I.K[4],2:I.K[5],3:I.K[6],4:I.K[7],5:I.K[0],6:I.K[1],7:I.K[2]},8:{0:I.K[4],1:I.K[5],2:I.K[6],3:I.K[7],4:I.K[0],5:I.K[1],6:I.K[2],7:I.K[3]},10:{0:I.K[5],1:I.K[6],2:I.K[7],3:I.K[0],4:I.K[1],5:I.K[2],6:I.K[3],7:I.K[4]},12:{0:I.K[6],1:I.K[7],2:I.K[0],3:I.K[1],4:I.K[2],5:I.K[3],6:I.K[4],7:I.K[5]},14:{0:I.K[7],1:I.K[0],2:I.K[1],3:I.K[2],4:I.K[3],5:I.K[4],6:I.K[5],7:I.K[6]},16:I.K,18:{0:I.K[1],1:I.K[2],2:I.K[3],3:I.K[4],4:I.K[5],5:I.K[6],6:I.K[7],7:I.K[0]}};}
  
		for(n=0;n<=I.r;n+=2){D=[];
         for(j=0;j<I.c;j++){c=0;D[j]=[];for(i=0;i<8;i++){D[j][i]=q[n/2][j][i]+Ks[j][i]+c;if(D[j][i]>255){D[j][i]&=255;c=1;}else c=0;}}
         for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){A[j][i]=D[j][i]+w[n][j][i]+c;if(A[j][i]>255){A[j][i]&=255;c=1;}else c=0;A[j][i]=I.S[i][A[j][i]];B[(j+I.shift[i])&(I.c_1)][i]=A[j][i];}}
         for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],B[j][k]);A[j][i]=I.S[i][(a&255)^D[j][i]];C[(j+I.shift[i])&(I.c_1)][i]=A[j][i];}            
		 for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],C[j][k]);A[j][i]=(a&255)+D[j][i]+c;if(A[j][i]>255){A[j][i]&=255;c=1;}else c=0;}}
         for(j=0;j<I.c;j++)for(i=0;i<8;i++)I.Kr[n][j][i]=A[j][i];
		 if(n<I.r){for(j=0;j<I.c;j++)for(i=0;i<8;i++){I.Kr[n+1][j][i]=I.Kr[n][(j+parseInt((i+x)/8))&I.c_1][(i+x)&7];}}
		}
    }
    I.showRoundKeys=function(){for(var n=0;n<=I.r;n++)console.log(n+': '+I.toString(I.Kr[n]));}
    function encrypt(){var a,c,i,j,k,z,E=[];
		for(j=0;j<I.c;j++){E[j]=[];c=0;for(i=0;i<8;i++){I.G[j][i]=I.G[j][i]+I.Kr[0][j][i]+c;if(I.G[j][i]>255){I.G[j][i]&=255;c=1;}else c=0;E[j][i]=0;}}
		for(z=1;z<I.r;z++){
            for(j=0;j<I.c;j++)for(i=0;i<8;i++){I.G[j][i]=I.S[i][I.G[j][i]];E[(j+I.shift[i])&(I.c_1)][i]=I.G[j][i];}
            for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],E[j][k]);I.G[j][i]=(a&255)^(I.Kr[z][j][i]);}
		}
		for(j=0;j<I.c;j++)for(i=0;i<8;i++){I.G[j][i]=I.S[i][I.G[j][i]];E[(j+I.shift[i])&(I.c_1)][i]=I.G[j][i];}
		for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I.v[(k-i+8)&7],E[j][k]);I.G[j][i]=(a&255)+I.Kr[z][j][i]+c;if(I.G[j][i]>255){I.G[j][i]&=255;c=1;}else c=0;}}
	}
    function decrypt(){var a,c,i,j,k,E=[],z=I.r;
		for(j=0;j<I.c;j++){E[j]=[];c=0;for(i=0;i<8;i++){I.G[j][i]=I.G[j][i]-I.Kr[z][j][i]-c;if(I.G[j][i]<0){I.G[j][i]=(I.G[j][i]+256)&255;c=1;}else c=0;E[j][i]=0;}}
		for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I._v[(k-i+8)&7],I.G[j][k]);E[(j-I.shift[i]+I.c)&(I.c_1)][i]=I.Q[i][(a&255)];}
		for(z=I.r-1;z>0;z--){
			for(j=0;j<I.c;j++)for(i=0;i<8;i++){I.G[j][i]=E[j][i]^(I.Kr[z][j][i]);}
			for(j=0;j<I.c;j++)for(i=0;i<8;i++){a=0;for(k=0;k<8;k++)a^=I.M(I._v[(k-i+8)&7],I.G[j][k]);E[(j-I.shift[i]+I.c)&(I.c_1)][i]=I.Q[i][(a&255)];}
		}
		for(j=0;j<I.c;j++){c=0;for(i=0;i<8;i++){I.G[j][i]=E[j][i]-I.Kr[z][j][i]-c;if(I.G[j][i]<0){I.G[j][i]=(I.G[j][i]+256)&255;c=1;}else c=0;}}
	}
    I.encryptHex=function(s){var i,j;for(j=0;j<I.c;j++)for(i=0;i<8;i++)if(s[(j*8+i)*2]!==undefined&&s[(j*8+i)*2+1]!==undefined)I.G[j][i]=parseInt(s[(j*8+i)*2]+''+s[(j*8+i)*2+1],16);else throw "Invalid data hexadecimal string format";encrypt();return I.toString();}
    I.decryptHex=function(s){var i,j;for(j=0;j<I.c;j++)for(i=0;i<8;i++)if(s[(j*8+i)*2]!==undefined&&s[(j*8+i)*2+1]!==undefined)I.G[j][i]=parseInt(s[(j*8+i)*2]+''+s[(j*8+i)*2+1],16);else throw "Invalid data hexadecimal string format";decrypt();return I.toString();}
    function utf8compose(s){if(s===undefined)return undefined;var r="",i=0,a,b,c,l=s.length;while(i<l){c=s.charCodeAt(i);if(c<128){r+=String.fromCharCode(c);i++;}else if(c>191){b=s.charCodeAt(i+1);if(c<224){r+=String.fromCharCode(((c&31)<<6)|(b&63));i+=2;}else{a=s.charCodeAt(i+2);r+=String.fromCharCode(((c&15)<<12)|((b&63)<<6)|(a&63));i+=3;}}else throw "Unsupported symbol";}return r;}
    function utf8decompose(u){if(u===undefined)return undefined;var s=u.replace(/\r\n/g,"\n"),r="",i,l=s.length,c;for(i=0;i<l;i++){c=s.charCodeAt(i);if(c<128)r+=String.fromCharCode(c);else if(c<2048)r+=String.fromCharCode((c>>6)|192)+String.fromCharCode((c&63)|128);else r+=String.fromCharCode((c>>12)|224)+String.fromCharCode(((c>>6)&63)|128)+String.fromCharCode((c&63)|128);}return r;}
    I.transportEncode=function(s){var a,b,c,d,e,f,g,i,l=s.length,k=l-l%3,r="";
        for(i=0;i<k;i+=3){a=s.charCodeAt(i);b=s.charCodeAt(i+1);c=s.charCodeAt(i+2);d=a>>2;e=((a&3)<<4)|(b>>4);f=((b&15)<<2)|(c>>6);g=c&63;r+=I.T[d]+I.T[e]+I.T[f]+I.T[g];}
        if(l>k){a=s.charCodeAt(k);d=a>>2;e=((a&3)<<4);f=-1;if(l>k+1){b=s.charCodeAt(k+1);e|=(b >> 4);f=((b&15) << 2);}r+=I.T[d]+I.T[e];if(f!=-1)r+=I.T[f];}return r;
    }
    
    I.transportDecode=function(s){var a,b,c,d,e,f,g,i,l=s.length,k=l-(l&3),r="";
        for(i=0;i<k;i+=4){d=I.T.indexOf(s.charAt(i));e=I.T.indexOf(s.charAt(i+1));f=I.T.indexOf(s.charAt(i+2));g=I.T.indexOf(s.charAt(i+3));a=(d<<2)|(e>>4);b=((e&15)<<4)|(f>>2);c=((f&3)<<6)|g;r+=String.fromCharCode(a)+String.fromCharCode(b)+String.fromCharCode(c);}
        if(l>k){d=I.T.indexOf(s.charAt(k));e=(l>k+1)?I.T.indexOf(s.charAt(k+1)):64;f=(l>k+2)?I.T.indexOf(s.charAt(k+2)):64;a=(d<<2)|(e>>4);b=((e&15)<<4)|(f>>2);r+=String.fromCharCode(a);if(f!=64){r+=String.fromCharCode(b);}}return r;
    }
    
    I.encryptStr=function(s){if(s===undefined) throw "No input string";var k,i,j,u=utf8decompose(s),l=u.length,m = I.b/8,r = "";
        for(k=0;k<l;k+=m){
            for(j=0;j<I.c;j++)for(i=0;i<8;i++)if(u[k+j*8+i]!==undefined)I.G[j][i]=u[k+j*8+i].charCodeAt(0);else I.G[j][i]=0;encrypt();
            for(j=0;j<I.c;j++)for(i=0;i<8;i++)r+=String.fromCharCode(I.G[j][i]);
        }return r;
	}
    I.decryptStr=function(s){if(s===undefined) throw "No input string";var i,j,k,l=s.length,m=I.b/8,r = "";
        for(k=0;k<l;k+=m){
            for(j=0;j<I.c;j++)for(i=0;i<8;i++)if(s[k+j*8+i]!==undefined)I.G[j][i]=s[k+j*8+i].charCodeAt(0);else throw "Invalid cipher string format";decrypt();
            for(j=0;j<I.c;j++)for(i=0;i<8;i++)r+=String.fromCharCode(I.G[j][i]);
        }return utf8compose(r);
    }
}